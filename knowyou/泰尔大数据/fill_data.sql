---------strat------------------
---------paramdt-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_paramdt_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.handsetTime') AS handset_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.pointId') AS point_id,
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.sp_seqid') AS sp_seqid,
    get_json_object(j.info,'$.msg_type') AS msg_type,
    get_json_object(j.info,'$.msg_id') AS msg_id,
    get_json_object(j.info,'$.msg_entity') AS msg_entity,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.app_dlrate') AS app_dlrate,
    get_json_object(j.info,'$.app_ulrate') AS app_ulrate,
    get_json_object(j.info,'$.delay') AS delay,
    get_json_object(j.info,'$.vmos') AS vmos,
    get_json_object(j.info,'$.isReal') AS is_real,
    get_json_object(j.info,'$.cellName') AS cell_name,
    get_json_object(j.info,'$.cellDistance') AS cell_distance,
    get_json_object(j.info,'$.isInterference') AS is_interference,
    get_json_object(j.info,'$.isOverlap') AS is_overlap,
    get_json_object(j.info,'$.isNoMajorCell') AS is_no_major_cell,
    get_json_object(j.info,'$.isCrossCoverage') AS is_cross_coverage,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        dt_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220703'  
    AND length(dt_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.dt_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


-----------app---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_app_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.provider') AS provider,
    get_json_object(j.info,'$.filesize') AS filesize,
    get_json_object(j.info,'$.threadCount') AS thread_count,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        app_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220703' 
    AND length(app_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.app_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


----------speed---------------------------------------------------------------------------------------------
INSERT overwrite TABLE knowyou_ott_ods.odm_tair_speed_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.protocolType') AS protocol_type,
    get_json_object(j.info,'$.threads') AS threads,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dlAvgSpeed') AS dl_avg_speed,
    get_json_object(j.info,'$.dlMaxSpeed') AS dl_max_speed,
    get_json_object(j.info,'$.dlDuration') AS dl_duration,
    get_json_object(j.info,'$.dlTotalBytes') AS dl_total_bytes,
    get_json_object(j.info,'$.ulAvgSpeed') AS ul_avg_speed,
    get_json_object(j.info,'$.ulMaxSpeed') AS ul_max_speed,
    get_json_object(j.info,'$.ulDuration') AS ul_duration,
    get_json_object(j.info,'$.ulTotalBytes') AS ul_total_bytes,
    get_json_object(j.info,'$.pingDelay') AS ping_delay,
    get_json_object(j.info,'$.score') AS score,
    get_json_object(j.info,'$.score2') AS score2,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_group_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220703' 
    AND length(ftp_group_info_list) > 2 
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_group_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
-----------ftp---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ftp_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.maxSpeed') AS max_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.totalBytes') AS total_bytes,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220703' 
    AND length(ftp_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;



------------http--------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_http_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dnsDelay') AS dns_delay,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.requestDelay') AS request_delay,
    get_json_object(j.info,'$.firstPkgDelay') AS first_pkg_delay,
    get_json_object(j.info,'$.firstScreenDelay') AS first_screen_delay,
    get_json_object(j.info,'$.loadDelay') AS load_delay,
    get_json_object(j.info,'$.dlAvgRate') AS dl_avg_rate,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        http_bower_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220703' 
    AND length(http_bower_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.http_bower_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


 
-----------ping---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ping_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.pingType') AS ping_type,
    get_json_object(j.info,'$.packetCount') AS packet_count,
    get_json_object(j.info,'$.packetSize') AS packet_size,
    get_json_object(j.info,'$.minDelay') AS min_delay,
    get_json_object(j.info,'$.maxDelay') AS max_delay,
    get_json_object(j.info,'$.avgDelay') AS avg_delay,
    get_json_object(j.info,'$.jitter') AS jitter,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ping_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220703' 
    AND length(ping_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ping_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
---------spdouyin_-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_spdouyin_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.hotSearchDelay') AS hot_search_delay,
    get_json_object(j.info,'$.recommendDelay') AS recommend_delay,
    get_json_object(j.info,'$.playAttempt') AS play_attempt,
    get_json_object(j.info,'$.playFailured') AS play_failured,
    get_json_object(j.info,'$.playDroped') AS play_droped,
    get_json_object(j.info,'$.initialbuffertime') AS initialbuffertime,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.rbufferCount') AS rbuffer_count,
    get_json_object(j.info,'$.rbufferTime') AS rbuffer_time,
    get_json_object(j.info,'$.maxRbufferTime') AS max_rbuffer_time,
    get_json_object(j.info,'$.bufferRatio') AS buffer_ratio,
    get_json_object(j.info,'$.avgBitrate') AS avg_bitrate,
    get_json_object(j.info,'$.maxBitrate') AS max_bitrate,
    get_json_object(j.info,'$.vmos') AS vmos,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    get_json_object(j.info,'$.avgFrameRate') AS avg_frame_rate,
    get_json_object(j.info,'$.sumBitrate') AS total_bitrate,
    get_json_object(j.info,'$.videoWidth') AS video_width,
    get_json_object(j.info,'$.videoHeight') AS video_height,
    get_json_object(j.info,'$.videoDecoder') AS video_decoder,
    get_json_object(j.info,'$.audioDecoder') AS audio_decoder,
    a.dt,
    a.ht
FROM
(
    SELECT  
        deviceid,
        tiktok_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220703' 
    AND length(tiktok_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.tiktok_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

--end------------------------------------------------------------------------------------

---------strat------------------
---------paramdt-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_paramdt_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.handsetTime') AS handset_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.pointId') AS point_id,
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.sp_seqid') AS sp_seqid,
    get_json_object(j.info,'$.msg_type') AS msg_type,
    get_json_object(j.info,'$.msg_id') AS msg_id,
    get_json_object(j.info,'$.msg_entity') AS msg_entity,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.app_dlrate') AS app_dlrate,
    get_json_object(j.info,'$.app_ulrate') AS app_ulrate,
    get_json_object(j.info,'$.delay') AS delay,
    get_json_object(j.info,'$.vmos') AS vmos,
    get_json_object(j.info,'$.isReal') AS is_real,
    get_json_object(j.info,'$.cellName') AS cell_name,
    get_json_object(j.info,'$.cellDistance') AS cell_distance,
    get_json_object(j.info,'$.isInterference') AS is_interference,
    get_json_object(j.info,'$.isOverlap') AS is_overlap,
    get_json_object(j.info,'$.isNoMajorCell') AS is_no_major_cell,
    get_json_object(j.info,'$.isCrossCoverage') AS is_cross_coverage,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        dt_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220704'  
    AND length(dt_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.dt_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


-----------app---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_app_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.provider') AS provider,
    get_json_object(j.info,'$.filesize') AS filesize,
    get_json_object(j.info,'$.threadCount') AS thread_count,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        app_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220704' 
    AND length(app_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.app_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


----------speed---------------------------------------------------------------------------------------------
INSERT overwrite TABLE knowyou_ott_ods.odm_tair_speed_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.protocolType') AS protocol_type,
    get_json_object(j.info,'$.threads') AS threads,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dlAvgSpeed') AS dl_avg_speed,
    get_json_object(j.info,'$.dlMaxSpeed') AS dl_max_speed,
    get_json_object(j.info,'$.dlDuration') AS dl_duration,
    get_json_object(j.info,'$.dlTotalBytes') AS dl_total_bytes,
    get_json_object(j.info,'$.ulAvgSpeed') AS ul_avg_speed,
    get_json_object(j.info,'$.ulMaxSpeed') AS ul_max_speed,
    get_json_object(j.info,'$.ulDuration') AS ul_duration,
    get_json_object(j.info,'$.ulTotalBytes') AS ul_total_bytes,
    get_json_object(j.info,'$.pingDelay') AS ping_delay,
    get_json_object(j.info,'$.score') AS score,
    get_json_object(j.info,'$.score2') AS score2,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_group_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220704' 
    AND length(ftp_group_info_list) > 2 
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_group_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
-----------ftp---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ftp_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.maxSpeed') AS max_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.totalBytes') AS total_bytes,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220704' 
    AND length(ftp_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;



------------http--------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_http_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dnsDelay') AS dns_delay,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.requestDelay') AS request_delay,
    get_json_object(j.info,'$.firstPkgDelay') AS first_pkg_delay,
    get_json_object(j.info,'$.firstScreenDelay') AS first_screen_delay,
    get_json_object(j.info,'$.loadDelay') AS load_delay,
    get_json_object(j.info,'$.dlAvgRate') AS dl_avg_rate,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        http_bower_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220704' 
    AND length(http_bower_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.http_bower_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


 
-----------ping---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ping_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.pingType') AS ping_type,
    get_json_object(j.info,'$.packetCount') AS packet_count,
    get_json_object(j.info,'$.packetSize') AS packet_size,
    get_json_object(j.info,'$.minDelay') AS min_delay,
    get_json_object(j.info,'$.maxDelay') AS max_delay,
    get_json_object(j.info,'$.avgDelay') AS avg_delay,
    get_json_object(j.info,'$.jitter') AS jitter,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ping_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220704' 
    AND length(ping_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ping_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
---------spdouyin_-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_spdouyin_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.hotSearchDelay') AS hot_search_delay,
    get_json_object(j.info,'$.recommendDelay') AS recommend_delay,
    get_json_object(j.info,'$.playAttempt') AS play_attempt,
    get_json_object(j.info,'$.playFailured') AS play_failured,
    get_json_object(j.info,'$.playDroped') AS play_droped,
    get_json_object(j.info,'$.initialbuffertime') AS initialbuffertime,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.rbufferCount') AS rbuffer_count,
    get_json_object(j.info,'$.rbufferTime') AS rbuffer_time,
    get_json_object(j.info,'$.maxRbufferTime') AS max_rbuffer_time,
    get_json_object(j.info,'$.bufferRatio') AS buffer_ratio,
    get_json_object(j.info,'$.avgBitrate') AS avg_bitrate,
    get_json_object(j.info,'$.maxBitrate') AS max_bitrate,
    get_json_object(j.info,'$.vmos') AS vmos,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    get_json_object(j.info,'$.avgFrameRate') AS avg_frame_rate,
    get_json_object(j.info,'$.sumBitrate') AS total_bitrate,
    get_json_object(j.info,'$.videoWidth') AS video_width,
    get_json_object(j.info,'$.videoHeight') AS video_height,
    get_json_object(j.info,'$.videoDecoder') AS video_decoder,
    get_json_object(j.info,'$.audioDecoder') AS audio_decoder,
    a.dt,
    a.ht
FROM
(
    SELECT  
        deviceid,
        tiktok_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220704' 
    AND length(tiktok_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.tiktok_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

--end------------------------------------------------------------------------------------
---------strat------------------
---------paramdt-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_paramdt_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.handsetTime') AS handset_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.pointId') AS point_id,
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.sp_seqid') AS sp_seqid,
    get_json_object(j.info,'$.msg_type') AS msg_type,
    get_json_object(j.info,'$.msg_id') AS msg_id,
    get_json_object(j.info,'$.msg_entity') AS msg_entity,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.app_dlrate') AS app_dlrate,
    get_json_object(j.info,'$.app_ulrate') AS app_ulrate,
    get_json_object(j.info,'$.delay') AS delay,
    get_json_object(j.info,'$.vmos') AS vmos,
    get_json_object(j.info,'$.isReal') AS is_real,
    get_json_object(j.info,'$.cellName') AS cell_name,
    get_json_object(j.info,'$.cellDistance') AS cell_distance,
    get_json_object(j.info,'$.isInterference') AS is_interference,
    get_json_object(j.info,'$.isOverlap') AS is_overlap,
    get_json_object(j.info,'$.isNoMajorCell') AS is_no_major_cell,
    get_json_object(j.info,'$.isCrossCoverage') AS is_cross_coverage,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        dt_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220705'  
    AND length(dt_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.dt_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


-----------app---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_app_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.provider') AS provider,
    get_json_object(j.info,'$.filesize') AS filesize,
    get_json_object(j.info,'$.threadCount') AS thread_count,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        app_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220705' 
    AND length(app_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.app_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


----------speed---------------------------------------------------------------------------------------------
INSERT overwrite TABLE knowyou_ott_ods.odm_tair_speed_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.protocolType') AS protocol_type,
    get_json_object(j.info,'$.threads') AS threads,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dlAvgSpeed') AS dl_avg_speed,
    get_json_object(j.info,'$.dlMaxSpeed') AS dl_max_speed,
    get_json_object(j.info,'$.dlDuration') AS dl_duration,
    get_json_object(j.info,'$.dlTotalBytes') AS dl_total_bytes,
    get_json_object(j.info,'$.ulAvgSpeed') AS ul_avg_speed,
    get_json_object(j.info,'$.ulMaxSpeed') AS ul_max_speed,
    get_json_object(j.info,'$.ulDuration') AS ul_duration,
    get_json_object(j.info,'$.ulTotalBytes') AS ul_total_bytes,
    get_json_object(j.info,'$.pingDelay') AS ping_delay,
    get_json_object(j.info,'$.score') AS score,
    get_json_object(j.info,'$.score2') AS score2,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_group_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220705' 
    AND length(ftp_group_info_list) > 2 
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_group_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
-----------ftp---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ftp_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.maxSpeed') AS max_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.totalBytes') AS total_bytes,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220705' 
    AND length(ftp_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;



------------http--------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_http_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dnsDelay') AS dns_delay,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.requestDelay') AS request_delay,
    get_json_object(j.info,'$.firstPkgDelay') AS first_pkg_delay,
    get_json_object(j.info,'$.firstScreenDelay') AS first_screen_delay,
    get_json_object(j.info,'$.loadDelay') AS load_delay,
    get_json_object(j.info,'$.dlAvgRate') AS dl_avg_rate,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        http_bower_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220705' 
    AND length(http_bower_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.http_bower_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


 
-----------ping---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ping_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.pingType') AS ping_type,
    get_json_object(j.info,'$.packetCount') AS packet_count,
    get_json_object(j.info,'$.packetSize') AS packet_size,
    get_json_object(j.info,'$.minDelay') AS min_delay,
    get_json_object(j.info,'$.maxDelay') AS max_delay,
    get_json_object(j.info,'$.avgDelay') AS avg_delay,
    get_json_object(j.info,'$.jitter') AS jitter,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ping_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220705' 
    AND length(ping_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ping_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
---------spdouyin_-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_spdouyin_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.hotSearchDelay') AS hot_search_delay,
    get_json_object(j.info,'$.recommendDelay') AS recommend_delay,
    get_json_object(j.info,'$.playAttempt') AS play_attempt,
    get_json_object(j.info,'$.playFailured') AS play_failured,
    get_json_object(j.info,'$.playDroped') AS play_droped,
    get_json_object(j.info,'$.initialbuffertime') AS initialbuffertime,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.rbufferCount') AS rbuffer_count,
    get_json_object(j.info,'$.rbufferTime') AS rbuffer_time,
    get_json_object(j.info,'$.maxRbufferTime') AS max_rbuffer_time,
    get_json_object(j.info,'$.bufferRatio') AS buffer_ratio,
    get_json_object(j.info,'$.avgBitrate') AS avg_bitrate,
    get_json_object(j.info,'$.maxBitrate') AS max_bitrate,
    get_json_object(j.info,'$.vmos') AS vmos,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    get_json_object(j.info,'$.avgFrameRate') AS avg_frame_rate,
    get_json_object(j.info,'$.sumBitrate') AS total_bitrate,
    get_json_object(j.info,'$.videoWidth') AS video_width,
    get_json_object(j.info,'$.videoHeight') AS video_height,
    get_json_object(j.info,'$.videoDecoder') AS video_decoder,
    get_json_object(j.info,'$.audioDecoder') AS audio_decoder,
    a.dt,
    a.ht
FROM
(
    SELECT  
        deviceid,
        tiktok_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220705' 
    AND length(tiktok_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.tiktok_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

--end------------------------------------------------------------------------------------
---------strat------------------
---------paramdt-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_paramdt_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.handsetTime') AS handset_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.pointId') AS point_id,
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.sp_seqid') AS sp_seqid,
    get_json_object(j.info,'$.msg_type') AS msg_type,
    get_json_object(j.info,'$.msg_id') AS msg_id,
    get_json_object(j.info,'$.msg_entity') AS msg_entity,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.app_dlrate') AS app_dlrate,
    get_json_object(j.info,'$.app_ulrate') AS app_ulrate,
    get_json_object(j.info,'$.delay') AS delay,
    get_json_object(j.info,'$.vmos') AS vmos,
    get_json_object(j.info,'$.isReal') AS is_real,
    get_json_object(j.info,'$.cellName') AS cell_name,
    get_json_object(j.info,'$.cellDistance') AS cell_distance,
    get_json_object(j.info,'$.isInterference') AS is_interference,
    get_json_object(j.info,'$.isOverlap') AS is_overlap,
    get_json_object(j.info,'$.isNoMajorCell') AS is_no_major_cell,
    get_json_object(j.info,'$.isCrossCoverage') AS is_cross_coverage,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        dt_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220706'  
    AND length(dt_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.dt_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


-----------app---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_app_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.provider') AS provider,
    get_json_object(j.info,'$.filesize') AS filesize,
    get_json_object(j.info,'$.threadCount') AS thread_count,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        app_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220706' 
    AND length(app_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.app_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


----------speed---------------------------------------------------------------------------------------------
INSERT overwrite TABLE knowyou_ott_ods.odm_tair_speed_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.protocolType') AS protocol_type,
    get_json_object(j.info,'$.threads') AS threads,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dlAvgSpeed') AS dl_avg_speed,
    get_json_object(j.info,'$.dlMaxSpeed') AS dl_max_speed,
    get_json_object(j.info,'$.dlDuration') AS dl_duration,
    get_json_object(j.info,'$.dlTotalBytes') AS dl_total_bytes,
    get_json_object(j.info,'$.ulAvgSpeed') AS ul_avg_speed,
    get_json_object(j.info,'$.ulMaxSpeed') AS ul_max_speed,
    get_json_object(j.info,'$.ulDuration') AS ul_duration,
    get_json_object(j.info,'$.ulTotalBytes') AS ul_total_bytes,
    get_json_object(j.info,'$.pingDelay') AS ping_delay,
    get_json_object(j.info,'$.score') AS score,
    get_json_object(j.info,'$.score2') AS score2,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_group_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220706' 
    AND length(ftp_group_info_list) > 2 
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_group_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
-----------ftp---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ftp_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.maxSpeed') AS max_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.totalBytes') AS total_bytes,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220706' 
    AND length(ftp_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;



------------http--------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_http_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dnsDelay') AS dns_delay,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.requestDelay') AS request_delay,
    get_json_object(j.info,'$.firstPkgDelay') AS first_pkg_delay,
    get_json_object(j.info,'$.firstScreenDelay') AS first_screen_delay,
    get_json_object(j.info,'$.loadDelay') AS load_delay,
    get_json_object(j.info,'$.dlAvgRate') AS dl_avg_rate,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        http_bower_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220706' 
    AND length(http_bower_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.http_bower_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


 
-----------ping---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ping_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.pingType') AS ping_type,
    get_json_object(j.info,'$.packetCount') AS packet_count,
    get_json_object(j.info,'$.packetSize') AS packet_size,
    get_json_object(j.info,'$.minDelay') AS min_delay,
    get_json_object(j.info,'$.maxDelay') AS max_delay,
    get_json_object(j.info,'$.avgDelay') AS avg_delay,
    get_json_object(j.info,'$.jitter') AS jitter,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ping_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220706' 
    AND length(ping_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ping_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
---------spdouyin_-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_spdouyin_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.hotSearchDelay') AS hot_search_delay,
    get_json_object(j.info,'$.recommendDelay') AS recommend_delay,
    get_json_object(j.info,'$.playAttempt') AS play_attempt,
    get_json_object(j.info,'$.playFailured') AS play_failured,
    get_json_object(j.info,'$.playDroped') AS play_droped,
    get_json_object(j.info,'$.initialbuffertime') AS initialbuffertime,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.rbufferCount') AS rbuffer_count,
    get_json_object(j.info,'$.rbufferTime') AS rbuffer_time,
    get_json_object(j.info,'$.maxRbufferTime') AS max_rbuffer_time,
    get_json_object(j.info,'$.bufferRatio') AS buffer_ratio,
    get_json_object(j.info,'$.avgBitrate') AS avg_bitrate,
    get_json_object(j.info,'$.maxBitrate') AS max_bitrate,
    get_json_object(j.info,'$.vmos') AS vmos,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    get_json_object(j.info,'$.avgFrameRate') AS avg_frame_rate,
    get_json_object(j.info,'$.sumBitrate') AS total_bitrate,
    get_json_object(j.info,'$.videoWidth') AS video_width,
    get_json_object(j.info,'$.videoHeight') AS video_height,
    get_json_object(j.info,'$.videoDecoder') AS video_decoder,
    get_json_object(j.info,'$.audioDecoder') AS audio_decoder,
    a.dt,
    a.ht
FROM
(
    SELECT  
        deviceid,
        tiktok_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220706' 
    AND length(tiktok_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.tiktok_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

--end------------------------------------------------------------------------------------
---------strat------------------
---------paramdt-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_paramdt_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.handsetTime') AS handset_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.pointId') AS point_id,
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.sp_seqid') AS sp_seqid,
    get_json_object(j.info,'$.msg_type') AS msg_type,
    get_json_object(j.info,'$.msg_id') AS msg_id,
    get_json_object(j.info,'$.msg_entity') AS msg_entity,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.app_dlrate') AS app_dlrate,
    get_json_object(j.info,'$.app_ulrate') AS app_ulrate,
    get_json_object(j.info,'$.delay') AS delay,
    get_json_object(j.info,'$.vmos') AS vmos,
    get_json_object(j.info,'$.isReal') AS is_real,
    get_json_object(j.info,'$.cellName') AS cell_name,
    get_json_object(j.info,'$.cellDistance') AS cell_distance,
    get_json_object(j.info,'$.isInterference') AS is_interference,
    get_json_object(j.info,'$.isOverlap') AS is_overlap,
    get_json_object(j.info,'$.isNoMajorCell') AS is_no_major_cell,
    get_json_object(j.info,'$.isCrossCoverage') AS is_cross_coverage,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        dt_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220707'  
    AND length(dt_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.dt_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


-----------app---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_app_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.provider') AS provider,
    get_json_object(j.info,'$.filesize') AS filesize,
    get_json_object(j.info,'$.threadCount') AS thread_count,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        app_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220707' 
    AND length(app_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.app_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


----------speed---------------------------------------------------------------------------------------------
INSERT overwrite TABLE knowyou_ott_ods.odm_tair_speed_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.protocolType') AS protocol_type,
    get_json_object(j.info,'$.threads') AS threads,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dlAvgSpeed') AS dl_avg_speed,
    get_json_object(j.info,'$.dlMaxSpeed') AS dl_max_speed,
    get_json_object(j.info,'$.dlDuration') AS dl_duration,
    get_json_object(j.info,'$.dlTotalBytes') AS dl_total_bytes,
    get_json_object(j.info,'$.ulAvgSpeed') AS ul_avg_speed,
    get_json_object(j.info,'$.ulMaxSpeed') AS ul_max_speed,
    get_json_object(j.info,'$.ulDuration') AS ul_duration,
    get_json_object(j.info,'$.ulTotalBytes') AS ul_total_bytes,
    get_json_object(j.info,'$.pingDelay') AS ping_delay,
    get_json_object(j.info,'$.score') AS score,
    get_json_object(j.info,'$.score2') AS score2,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_group_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220707' 
    AND length(ftp_group_info_list) > 2 
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_group_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
-----------ftp---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ftp_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.maxSpeed') AS max_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.totalBytes') AS total_bytes,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220707' 
    AND length(ftp_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;



------------http--------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_http_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dnsDelay') AS dns_delay,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.requestDelay') AS request_delay,
    get_json_object(j.info,'$.firstPkgDelay') AS first_pkg_delay,
    get_json_object(j.info,'$.firstScreenDelay') AS first_screen_delay,
    get_json_object(j.info,'$.loadDelay') AS load_delay,
    get_json_object(j.info,'$.dlAvgRate') AS dl_avg_rate,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        http_bower_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220707' 
    AND length(http_bower_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.http_bower_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


 
-----------ping---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ping_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.pingType') AS ping_type,
    get_json_object(j.info,'$.packetCount') AS packet_count,
    get_json_object(j.info,'$.packetSize') AS packet_size,
    get_json_object(j.info,'$.minDelay') AS min_delay,
    get_json_object(j.info,'$.maxDelay') AS max_delay,
    get_json_object(j.info,'$.avgDelay') AS avg_delay,
    get_json_object(j.info,'$.jitter') AS jitter,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ping_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220707' 
    AND length(ping_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ping_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
---------spdouyin_-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_spdouyin_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.hotSearchDelay') AS hot_search_delay,
    get_json_object(j.info,'$.recommendDelay') AS recommend_delay,
    get_json_object(j.info,'$.playAttempt') AS play_attempt,
    get_json_object(j.info,'$.playFailured') AS play_failured,
    get_json_object(j.info,'$.playDroped') AS play_droped,
    get_json_object(j.info,'$.initialbuffertime') AS initialbuffertime,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.rbufferCount') AS rbuffer_count,
    get_json_object(j.info,'$.rbufferTime') AS rbuffer_time,
    get_json_object(j.info,'$.maxRbufferTime') AS max_rbuffer_time,
    get_json_object(j.info,'$.bufferRatio') AS buffer_ratio,
    get_json_object(j.info,'$.avgBitrate') AS avg_bitrate,
    get_json_object(j.info,'$.maxBitrate') AS max_bitrate,
    get_json_object(j.info,'$.vmos') AS vmos,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    get_json_object(j.info,'$.avgFrameRate') AS avg_frame_rate,
    get_json_object(j.info,'$.sumBitrate') AS total_bitrate,
    get_json_object(j.info,'$.videoWidth') AS video_width,
    get_json_object(j.info,'$.videoHeight') AS video_height,
    get_json_object(j.info,'$.videoDecoder') AS video_decoder,
    get_json_object(j.info,'$.audioDecoder') AS audio_decoder,
    a.dt,
    a.ht
FROM
(
    SELECT  
        deviceid,
        tiktok_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220707' 
    AND length(tiktok_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.tiktok_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

--end------------------------------------------------------------------------------------
---------strat------------------
---------paramdt-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_paramdt_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.handsetTime') AS handset_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.pointId') AS point_id,
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.sp_seqid') AS sp_seqid,
    get_json_object(j.info,'$.msg_type') AS msg_type,
    get_json_object(j.info,'$.msg_id') AS msg_id,
    get_json_object(j.info,'$.msg_entity') AS msg_entity,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.app_dlrate') AS app_dlrate,
    get_json_object(j.info,'$.app_ulrate') AS app_ulrate,
    get_json_object(j.info,'$.delay') AS delay,
    get_json_object(j.info,'$.vmos') AS vmos,
    get_json_object(j.info,'$.isReal') AS is_real,
    get_json_object(j.info,'$.cellName') AS cell_name,
    get_json_object(j.info,'$.cellDistance') AS cell_distance,
    get_json_object(j.info,'$.isInterference') AS is_interference,
    get_json_object(j.info,'$.isOverlap') AS is_overlap,
    get_json_object(j.info,'$.isNoMajorCell') AS is_no_major_cell,
    get_json_object(j.info,'$.isCrossCoverage') AS is_cross_coverage,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        dt_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220708'  
    AND length(dt_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.dt_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


-----------app---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_app_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.provider') AS provider,
    get_json_object(j.info,'$.filesize') AS filesize,
    get_json_object(j.info,'$.threadCount') AS thread_count,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        app_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220708' 
    AND length(app_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.app_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


----------speed---------------------------------------------------------------------------------------------
INSERT overwrite TABLE knowyou_ott_ods.odm_tair_speed_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.protocolType') AS protocol_type,
    get_json_object(j.info,'$.threads') AS threads,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dlAvgSpeed') AS dl_avg_speed,
    get_json_object(j.info,'$.dlMaxSpeed') AS dl_max_speed,
    get_json_object(j.info,'$.dlDuration') AS dl_duration,
    get_json_object(j.info,'$.dlTotalBytes') AS dl_total_bytes,
    get_json_object(j.info,'$.ulAvgSpeed') AS ul_avg_speed,
    get_json_object(j.info,'$.ulMaxSpeed') AS ul_max_speed,
    get_json_object(j.info,'$.ulDuration') AS ul_duration,
    get_json_object(j.info,'$.ulTotalBytes') AS ul_total_bytes,
    get_json_object(j.info,'$.pingDelay') AS ping_delay,
    get_json_object(j.info,'$.score') AS score,
    get_json_object(j.info,'$.score2') AS score2,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_group_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220708' 
    AND length(ftp_group_info_list) > 2 
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_group_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
-----------ftp---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ftp_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.maxSpeed') AS max_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.totalBytes') AS total_bytes,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220708' 
    AND length(ftp_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;



------------http--------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_http_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dnsDelay') AS dns_delay,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.requestDelay') AS request_delay,
    get_json_object(j.info,'$.firstPkgDelay') AS first_pkg_delay,
    get_json_object(j.info,'$.firstScreenDelay') AS first_screen_delay,
    get_json_object(j.info,'$.loadDelay') AS load_delay,
    get_json_object(j.info,'$.dlAvgRate') AS dl_avg_rate,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        http_bower_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220708' 
    AND length(http_bower_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.http_bower_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


 
-----------ping---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ping_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.pingType') AS ping_type,
    get_json_object(j.info,'$.packetCount') AS packet_count,
    get_json_object(j.info,'$.packetSize') AS packet_size,
    get_json_object(j.info,'$.minDelay') AS min_delay,
    get_json_object(j.info,'$.maxDelay') AS max_delay,
    get_json_object(j.info,'$.avgDelay') AS avg_delay,
    get_json_object(j.info,'$.jitter') AS jitter,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ping_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220708' 
    AND length(ping_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ping_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
---------spdouyin_-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_spdouyin_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.hotSearchDelay') AS hot_search_delay,
    get_json_object(j.info,'$.recommendDelay') AS recommend_delay,
    get_json_object(j.info,'$.playAttempt') AS play_attempt,
    get_json_object(j.info,'$.playFailured') AS play_failured,
    get_json_object(j.info,'$.playDroped') AS play_droped,
    get_json_object(j.info,'$.initialbuffertime') AS initialbuffertime,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.rbufferCount') AS rbuffer_count,
    get_json_object(j.info,'$.rbufferTime') AS rbuffer_time,
    get_json_object(j.info,'$.maxRbufferTime') AS max_rbuffer_time,
    get_json_object(j.info,'$.bufferRatio') AS buffer_ratio,
    get_json_object(j.info,'$.avgBitrate') AS avg_bitrate,
    get_json_object(j.info,'$.maxBitrate') AS max_bitrate,
    get_json_object(j.info,'$.vmos') AS vmos,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    get_json_object(j.info,'$.avgFrameRate') AS avg_frame_rate,
    get_json_object(j.info,'$.sumBitrate') AS total_bitrate,
    get_json_object(j.info,'$.videoWidth') AS video_width,
    get_json_object(j.info,'$.videoHeight') AS video_height,
    get_json_object(j.info,'$.videoDecoder') AS video_decoder,
    get_json_object(j.info,'$.audioDecoder') AS audio_decoder,
    a.dt,
    a.ht
FROM
(
    SELECT  
        deviceid,
        tiktok_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220708' 
    AND length(tiktok_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.tiktok_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

--end------------------------------------------------------------------------------------
---------strat------------------
---------paramdt-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_paramdt_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.handsetTime') AS handset_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.pointId') AS point_id,
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.sp_seqid') AS sp_seqid,
    get_json_object(j.info,'$.msg_type') AS msg_type,
    get_json_object(j.info,'$.msg_id') AS msg_id,
    get_json_object(j.info,'$.msg_entity') AS msg_entity,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.app_dlrate') AS app_dlrate,
    get_json_object(j.info,'$.app_ulrate') AS app_ulrate,
    get_json_object(j.info,'$.delay') AS delay,
    get_json_object(j.info,'$.vmos') AS vmos,
    get_json_object(j.info,'$.isReal') AS is_real,
    get_json_object(j.info,'$.cellName') AS cell_name,
    get_json_object(j.info,'$.cellDistance') AS cell_distance,
    get_json_object(j.info,'$.isInterference') AS is_interference,
    get_json_object(j.info,'$.isOverlap') AS is_overlap,
    get_json_object(j.info,'$.isNoMajorCell') AS is_no_major_cell,
    get_json_object(j.info,'$.isCrossCoverage') AS is_cross_coverage,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        dt_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220709'  
    AND length(dt_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.dt_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


-----------app---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_app_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.provider') AS provider,
    get_json_object(j.info,'$.filesize') AS filesize,
    get_json_object(j.info,'$.threadCount') AS thread_count,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        app_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220709' 
    AND length(app_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.app_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


----------speed---------------------------------------------------------------------------------------------
INSERT overwrite TABLE knowyou_ott_ods.odm_tair_speed_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.protocolType') AS protocol_type,
    get_json_object(j.info,'$.threads') AS threads,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dlAvgSpeed') AS dl_avg_speed,
    get_json_object(j.info,'$.dlMaxSpeed') AS dl_max_speed,
    get_json_object(j.info,'$.dlDuration') AS dl_duration,
    get_json_object(j.info,'$.dlTotalBytes') AS dl_total_bytes,
    get_json_object(j.info,'$.ulAvgSpeed') AS ul_avg_speed,
    get_json_object(j.info,'$.ulMaxSpeed') AS ul_max_speed,
    get_json_object(j.info,'$.ulDuration') AS ul_duration,
    get_json_object(j.info,'$.ulTotalBytes') AS ul_total_bytes,
    get_json_object(j.info,'$.pingDelay') AS ping_delay,
    get_json_object(j.info,'$.score') AS score,
    get_json_object(j.info,'$.score2') AS score2,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_group_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220709' 
    AND length(ftp_group_info_list) > 2 
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_group_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
-----------ftp---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ftp_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.maxSpeed') AS max_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.totalBytes') AS total_bytes,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220709' 
    AND length(ftp_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;



------------http--------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_http_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dnsDelay') AS dns_delay,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.requestDelay') AS request_delay,
    get_json_object(j.info,'$.firstPkgDelay') AS first_pkg_delay,
    get_json_object(j.info,'$.firstScreenDelay') AS first_screen_delay,
    get_json_object(j.info,'$.loadDelay') AS load_delay,
    get_json_object(j.info,'$.dlAvgRate') AS dl_avg_rate,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        http_bower_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220709' 
    AND length(http_bower_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.http_bower_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


 
-----------ping---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ping_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.pingType') AS ping_type,
    get_json_object(j.info,'$.packetCount') AS packet_count,
    get_json_object(j.info,'$.packetSize') AS packet_size,
    get_json_object(j.info,'$.minDelay') AS min_delay,
    get_json_object(j.info,'$.maxDelay') AS max_delay,
    get_json_object(j.info,'$.avgDelay') AS avg_delay,
    get_json_object(j.info,'$.jitter') AS jitter,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ping_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220709' 
    AND length(ping_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ping_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
---------spdouyin_-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_spdouyin_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.hotSearchDelay') AS hot_search_delay,
    get_json_object(j.info,'$.recommendDelay') AS recommend_delay,
    get_json_object(j.info,'$.playAttempt') AS play_attempt,
    get_json_object(j.info,'$.playFailured') AS play_failured,
    get_json_object(j.info,'$.playDroped') AS play_droped,
    get_json_object(j.info,'$.initialbuffertime') AS initialbuffertime,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.rbufferCount') AS rbuffer_count,
    get_json_object(j.info,'$.rbufferTime') AS rbuffer_time,
    get_json_object(j.info,'$.maxRbufferTime') AS max_rbuffer_time,
    get_json_object(j.info,'$.bufferRatio') AS buffer_ratio,
    get_json_object(j.info,'$.avgBitrate') AS avg_bitrate,
    get_json_object(j.info,'$.maxBitrate') AS max_bitrate,
    get_json_object(j.info,'$.vmos') AS vmos,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    get_json_object(j.info,'$.avgFrameRate') AS avg_frame_rate,
    get_json_object(j.info,'$.sumBitrate') AS total_bitrate,
    get_json_object(j.info,'$.videoWidth') AS video_width,
    get_json_object(j.info,'$.videoHeight') AS video_height,
    get_json_object(j.info,'$.videoDecoder') AS video_decoder,
    get_json_object(j.info,'$.audioDecoder') AS audio_decoder,
    a.dt,
    a.ht
FROM
(
    SELECT  
        deviceid,
        tiktok_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220709' 
    AND length(tiktok_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.tiktok_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

--end------------------------------------------------------------------------------------
---------strat------------------
---------paramdt-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_paramdt_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.handsetTime') AS handset_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.pointId') AS point_id,
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.sp_seqid') AS sp_seqid,
    get_json_object(j.info,'$.msg_type') AS msg_type,
    get_json_object(j.info,'$.msg_id') AS msg_id,
    get_json_object(j.info,'$.msg_entity') AS msg_entity,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.app_dlrate') AS app_dlrate,
    get_json_object(j.info,'$.app_ulrate') AS app_ulrate,
    get_json_object(j.info,'$.delay') AS delay,
    get_json_object(j.info,'$.vmos') AS vmos,
    get_json_object(j.info,'$.isReal') AS is_real,
    get_json_object(j.info,'$.cellName') AS cell_name,
    get_json_object(j.info,'$.cellDistance') AS cell_distance,
    get_json_object(j.info,'$.isInterference') AS is_interference,
    get_json_object(j.info,'$.isOverlap') AS is_overlap,
    get_json_object(j.info,'$.isNoMajorCell') AS is_no_major_cell,
    get_json_object(j.info,'$.isCrossCoverage') AS is_cross_coverage,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        dt_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220710'  
    AND length(dt_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.dt_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


-----------app---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_app_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.provider') AS provider,
    get_json_object(j.info,'$.filesize') AS filesize,
    get_json_object(j.info,'$.threadCount') AS thread_count,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        app_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220710' 
    AND length(app_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.app_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


----------speed---------------------------------------------------------------------------------------------
INSERT overwrite TABLE knowyou_ott_ods.odm_tair_speed_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.protocolType') AS protocol_type,
    get_json_object(j.info,'$.threads') AS threads,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dlAvgSpeed') AS dl_avg_speed,
    get_json_object(j.info,'$.dlMaxSpeed') AS dl_max_speed,
    get_json_object(j.info,'$.dlDuration') AS dl_duration,
    get_json_object(j.info,'$.dlTotalBytes') AS dl_total_bytes,
    get_json_object(j.info,'$.ulAvgSpeed') AS ul_avg_speed,
    get_json_object(j.info,'$.ulMaxSpeed') AS ul_max_speed,
    get_json_object(j.info,'$.ulDuration') AS ul_duration,
    get_json_object(j.info,'$.ulTotalBytes') AS ul_total_bytes,
    get_json_object(j.info,'$.pingDelay') AS ping_delay,
    get_json_object(j.info,'$.score') AS score,
    get_json_object(j.info,'$.score2') AS score2,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_group_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220710' 
    AND length(ftp_group_info_list) > 2 
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_group_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
-----------ftp---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ftp_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.maxSpeed') AS max_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.totalBytes') AS total_bytes,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220710' 
    AND length(ftp_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;



------------http--------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_http_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dnsDelay') AS dns_delay,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.requestDelay') AS request_delay,
    get_json_object(j.info,'$.firstPkgDelay') AS first_pkg_delay,
    get_json_object(j.info,'$.firstScreenDelay') AS first_screen_delay,
    get_json_object(j.info,'$.loadDelay') AS load_delay,
    get_json_object(j.info,'$.dlAvgRate') AS dl_avg_rate,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        http_bower_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220710' 
    AND length(http_bower_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.http_bower_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


 
-----------ping---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ping_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.pingType') AS ping_type,
    get_json_object(j.info,'$.packetCount') AS packet_count,
    get_json_object(j.info,'$.packetSize') AS packet_size,
    get_json_object(j.info,'$.minDelay') AS min_delay,
    get_json_object(j.info,'$.maxDelay') AS max_delay,
    get_json_object(j.info,'$.avgDelay') AS avg_delay,
    get_json_object(j.info,'$.jitter') AS jitter,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ping_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220710' 
    AND length(ping_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ping_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
---------spdouyin_-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_spdouyin_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.hotSearchDelay') AS hot_search_delay,
    get_json_object(j.info,'$.recommendDelay') AS recommend_delay,
    get_json_object(j.info,'$.playAttempt') AS play_attempt,
    get_json_object(j.info,'$.playFailured') AS play_failured,
    get_json_object(j.info,'$.playDroped') AS play_droped,
    get_json_object(j.info,'$.initialbuffertime') AS initialbuffertime,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.rbufferCount') AS rbuffer_count,
    get_json_object(j.info,'$.rbufferTime') AS rbuffer_time,
    get_json_object(j.info,'$.maxRbufferTime') AS max_rbuffer_time,
    get_json_object(j.info,'$.bufferRatio') AS buffer_ratio,
    get_json_object(j.info,'$.avgBitrate') AS avg_bitrate,
    get_json_object(j.info,'$.maxBitrate') AS max_bitrate,
    get_json_object(j.info,'$.vmos') AS vmos,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    get_json_object(j.info,'$.avgFrameRate') AS avg_frame_rate,
    get_json_object(j.info,'$.sumBitrate') AS total_bitrate,
    get_json_object(j.info,'$.videoWidth') AS video_width,
    get_json_object(j.info,'$.videoHeight') AS video_height,
    get_json_object(j.info,'$.videoDecoder') AS video_decoder,
    get_json_object(j.info,'$.audioDecoder') AS audio_decoder,
    a.dt,
    a.ht
FROM
(
    SELECT  
        deviceid,
        tiktok_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220710' 
    AND length(tiktok_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.tiktok_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

--end------------------------------------------------------------------------------------
---------strat------------------
---------paramdt-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_paramdt_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.handsetTime') AS handset_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.pointId') AS point_id,
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.sp_seqid') AS sp_seqid,
    get_json_object(j.info,'$.msg_type') AS msg_type,
    get_json_object(j.info,'$.msg_id') AS msg_id,
    get_json_object(j.info,'$.msg_entity') AS msg_entity,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.app_dlrate') AS app_dlrate,
    get_json_object(j.info,'$.app_ulrate') AS app_ulrate,
    get_json_object(j.info,'$.delay') AS delay,
    get_json_object(j.info,'$.vmos') AS vmos,
    get_json_object(j.info,'$.isReal') AS is_real,
    get_json_object(j.info,'$.cellName') AS cell_name,
    get_json_object(j.info,'$.cellDistance') AS cell_distance,
    get_json_object(j.info,'$.isInterference') AS is_interference,
    get_json_object(j.info,'$.isOverlap') AS is_overlap,
    get_json_object(j.info,'$.isNoMajorCell') AS is_no_major_cell,
    get_json_object(j.info,'$.isCrossCoverage') AS is_cross_coverage,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        dt_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220711'  
    AND length(dt_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.dt_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


-----------app---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_app_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.provider') AS provider,
    get_json_object(j.info,'$.filesize') AS filesize,
    get_json_object(j.info,'$.threadCount') AS thread_count,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        app_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220711' 
    AND length(app_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.app_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


----------speed---------------------------------------------------------------------------------------------
INSERT overwrite TABLE knowyou_ott_ods.odm_tair_speed_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.protocolType') AS protocol_type,
    get_json_object(j.info,'$.threads') AS threads,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dlAvgSpeed') AS dl_avg_speed,
    get_json_object(j.info,'$.dlMaxSpeed') AS dl_max_speed,
    get_json_object(j.info,'$.dlDuration') AS dl_duration,
    get_json_object(j.info,'$.dlTotalBytes') AS dl_total_bytes,
    get_json_object(j.info,'$.ulAvgSpeed') AS ul_avg_speed,
    get_json_object(j.info,'$.ulMaxSpeed') AS ul_max_speed,
    get_json_object(j.info,'$.ulDuration') AS ul_duration,
    get_json_object(j.info,'$.ulTotalBytes') AS ul_total_bytes,
    get_json_object(j.info,'$.pingDelay') AS ping_delay,
    get_json_object(j.info,'$.score') AS score,
    get_json_object(j.info,'$.score2') AS score2,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_group_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220711' 
    AND length(ftp_group_info_list) > 2 
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_group_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
-----------ftp---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ftp_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.maxSpeed') AS max_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.totalBytes') AS total_bytes,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220711' 
    AND length(ftp_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;



------------http--------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_http_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dnsDelay') AS dns_delay,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.requestDelay') AS request_delay,
    get_json_object(j.info,'$.firstPkgDelay') AS first_pkg_delay,
    get_json_object(j.info,'$.firstScreenDelay') AS first_screen_delay,
    get_json_object(j.info,'$.loadDelay') AS load_delay,
    get_json_object(j.info,'$.dlAvgRate') AS dl_avg_rate,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        http_bower_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220711' 
    AND length(http_bower_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.http_bower_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


 
-----------ping---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ping_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.pingType') AS ping_type,
    get_json_object(j.info,'$.packetCount') AS packet_count,
    get_json_object(j.info,'$.packetSize') AS packet_size,
    get_json_object(j.info,'$.minDelay') AS min_delay,
    get_json_object(j.info,'$.maxDelay') AS max_delay,
    get_json_object(j.info,'$.avgDelay') AS avg_delay,
    get_json_object(j.info,'$.jitter') AS jitter,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ping_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220711' 
    AND length(ping_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ping_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
---------spdouyin_-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_spdouyin_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.hotSearchDelay') AS hot_search_delay,
    get_json_object(j.info,'$.recommendDelay') AS recommend_delay,
    get_json_object(j.info,'$.playAttempt') AS play_attempt,
    get_json_object(j.info,'$.playFailured') AS play_failured,
    get_json_object(j.info,'$.playDroped') AS play_droped,
    get_json_object(j.info,'$.initialbuffertime') AS initialbuffertime,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.rbufferCount') AS rbuffer_count,
    get_json_object(j.info,'$.rbufferTime') AS rbuffer_time,
    get_json_object(j.info,'$.maxRbufferTime') AS max_rbuffer_time,
    get_json_object(j.info,'$.bufferRatio') AS buffer_ratio,
    get_json_object(j.info,'$.avgBitrate') AS avg_bitrate,
    get_json_object(j.info,'$.maxBitrate') AS max_bitrate,
    get_json_object(j.info,'$.vmos') AS vmos,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    get_json_object(j.info,'$.avgFrameRate') AS avg_frame_rate,
    get_json_object(j.info,'$.sumBitrate') AS total_bitrate,
    get_json_object(j.info,'$.videoWidth') AS video_width,
    get_json_object(j.info,'$.videoHeight') AS video_height,
    get_json_object(j.info,'$.videoDecoder') AS video_decoder,
    get_json_object(j.info,'$.audioDecoder') AS audio_decoder,
    a.dt,
    a.ht
FROM
(
    SELECT  
        deviceid,
        tiktok_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220711' 
    AND length(tiktok_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.tiktok_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

--end------------------------------------------------------------------------------------
---------strat------------------
---------paramdt-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_paramdt_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.handsetTime') AS handset_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.pointId') AS point_id,
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.sp_seqid') AS sp_seqid,
    get_json_object(j.info,'$.msg_type') AS msg_type,
    get_json_object(j.info,'$.msg_id') AS msg_id,
    get_json_object(j.info,'$.msg_entity') AS msg_entity,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.app_dlrate') AS app_dlrate,
    get_json_object(j.info,'$.app_ulrate') AS app_ulrate,
    get_json_object(j.info,'$.delay') AS delay,
    get_json_object(j.info,'$.vmos') AS vmos,
    get_json_object(j.info,'$.isReal') AS is_real,
    get_json_object(j.info,'$.cellName') AS cell_name,
    get_json_object(j.info,'$.cellDistance') AS cell_distance,
    get_json_object(j.info,'$.isInterference') AS is_interference,
    get_json_object(j.info,'$.isOverlap') AS is_overlap,
    get_json_object(j.info,'$.isNoMajorCell') AS is_no_major_cell,
    get_json_object(j.info,'$.isCrossCoverage') AS is_cross_coverage,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        dt_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220712'  
    AND length(dt_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.dt_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


-----------app---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_app_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.provider') AS provider,
    get_json_object(j.info,'$.filesize') AS filesize,
    get_json_object(j.info,'$.threadCount') AS thread_count,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        app_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220712' 
    AND length(app_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.app_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


----------speed---------------------------------------------------------------------------------------------
INSERT overwrite TABLE knowyou_ott_ods.odm_tair_speed_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.protocolType') AS protocol_type,
    get_json_object(j.info,'$.threads') AS threads,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dlAvgSpeed') AS dl_avg_speed,
    get_json_object(j.info,'$.dlMaxSpeed') AS dl_max_speed,
    get_json_object(j.info,'$.dlDuration') AS dl_duration,
    get_json_object(j.info,'$.dlTotalBytes') AS dl_total_bytes,
    get_json_object(j.info,'$.ulAvgSpeed') AS ul_avg_speed,
    get_json_object(j.info,'$.ulMaxSpeed') AS ul_max_speed,
    get_json_object(j.info,'$.ulDuration') AS ul_duration,
    get_json_object(j.info,'$.ulTotalBytes') AS ul_total_bytes,
    get_json_object(j.info,'$.pingDelay') AS ping_delay,
    get_json_object(j.info,'$.score') AS score,
    get_json_object(j.info,'$.score2') AS score2,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_group_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220712' 
    AND length(ftp_group_info_list) > 2 
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_group_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
-----------ftp---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ftp_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.maxSpeed') AS max_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.totalBytes') AS total_bytes,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220712' 
    AND length(ftp_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;



------------http--------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_http_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dnsDelay') AS dns_delay,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.requestDelay') AS request_delay,
    get_json_object(j.info,'$.firstPkgDelay') AS first_pkg_delay,
    get_json_object(j.info,'$.firstScreenDelay') AS first_screen_delay,
    get_json_object(j.info,'$.loadDelay') AS load_delay,
    get_json_object(j.info,'$.dlAvgRate') AS dl_avg_rate,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        http_bower_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220712' 
    AND length(http_bower_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.http_bower_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


 
-----------ping---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ping_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.pingType') AS ping_type,
    get_json_object(j.info,'$.packetCount') AS packet_count,
    get_json_object(j.info,'$.packetSize') AS packet_size,
    get_json_object(j.info,'$.minDelay') AS min_delay,
    get_json_object(j.info,'$.maxDelay') AS max_delay,
    get_json_object(j.info,'$.avgDelay') AS avg_delay,
    get_json_object(j.info,'$.jitter') AS jitter,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ping_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220712' 
    AND length(ping_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ping_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
---------spdouyin_-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_spdouyin_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.hotSearchDelay') AS hot_search_delay,
    get_json_object(j.info,'$.recommendDelay') AS recommend_delay,
    get_json_object(j.info,'$.playAttempt') AS play_attempt,
    get_json_object(j.info,'$.playFailured') AS play_failured,
    get_json_object(j.info,'$.playDroped') AS play_droped,
    get_json_object(j.info,'$.initialbuffertime') AS initialbuffertime,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.rbufferCount') AS rbuffer_count,
    get_json_object(j.info,'$.rbufferTime') AS rbuffer_time,
    get_json_object(j.info,'$.maxRbufferTime') AS max_rbuffer_time,
    get_json_object(j.info,'$.bufferRatio') AS buffer_ratio,
    get_json_object(j.info,'$.avgBitrate') AS avg_bitrate,
    get_json_object(j.info,'$.maxBitrate') AS max_bitrate,
    get_json_object(j.info,'$.vmos') AS vmos,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    get_json_object(j.info,'$.avgFrameRate') AS avg_frame_rate,
    get_json_object(j.info,'$.sumBitrate') AS total_bitrate,
    get_json_object(j.info,'$.videoWidth') AS video_width,
    get_json_object(j.info,'$.videoHeight') AS video_height,
    get_json_object(j.info,'$.videoDecoder') AS video_decoder,
    get_json_object(j.info,'$.audioDecoder') AS audio_decoder,
    a.dt,
    a.ht
FROM
(
    SELECT  
        deviceid,
        tiktok_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220712' 
    AND length(tiktok_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.tiktok_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

--end------------------------------------------------------------------------------------
---------strat------------------
---------paramdt-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_paramdt_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.handsetTime') AS handset_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.pointId') AS point_id,
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.sp_seqid') AS sp_seqid,
    get_json_object(j.info,'$.msg_type') AS msg_type,
    get_json_object(j.info,'$.msg_id') AS msg_id,
    get_json_object(j.info,'$.msg_entity') AS msg_entity,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.app_dlrate') AS app_dlrate,
    get_json_object(j.info,'$.app_ulrate') AS app_ulrate,
    get_json_object(j.info,'$.delay') AS delay,
    get_json_object(j.info,'$.vmos') AS vmos,
    get_json_object(j.info,'$.isReal') AS is_real,
    get_json_object(j.info,'$.cellName') AS cell_name,
    get_json_object(j.info,'$.cellDistance') AS cell_distance,
    get_json_object(j.info,'$.isInterference') AS is_interference,
    get_json_object(j.info,'$.isOverlap') AS is_overlap,
    get_json_object(j.info,'$.isNoMajorCell') AS is_no_major_cell,
    get_json_object(j.info,'$.isCrossCoverage') AS is_cross_coverage,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        dt_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220713'  
    AND length(dt_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.dt_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


-----------app---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_app_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.provider') AS provider,
    get_json_object(j.info,'$.filesize') AS filesize,
    get_json_object(j.info,'$.threadCount') AS thread_count,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        app_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220713' 
    AND length(app_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.app_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


----------speed---------------------------------------------------------------------------------------------
INSERT overwrite TABLE knowyou_ott_ods.odm_tair_speed_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.protocolType') AS protocol_type,
    get_json_object(j.info,'$.threads') AS threads,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dlAvgSpeed') AS dl_avg_speed,
    get_json_object(j.info,'$.dlMaxSpeed') AS dl_max_speed,
    get_json_object(j.info,'$.dlDuration') AS dl_duration,
    get_json_object(j.info,'$.dlTotalBytes') AS dl_total_bytes,
    get_json_object(j.info,'$.ulAvgSpeed') AS ul_avg_speed,
    get_json_object(j.info,'$.ulMaxSpeed') AS ul_max_speed,
    get_json_object(j.info,'$.ulDuration') AS ul_duration,
    get_json_object(j.info,'$.ulTotalBytes') AS ul_total_bytes,
    get_json_object(j.info,'$.pingDelay') AS ping_delay,
    get_json_object(j.info,'$.score') AS score,
    get_json_object(j.info,'$.score2') AS score2,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_group_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220713' 
    AND length(ftp_group_info_list) > 2 
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_group_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
-----------ftp---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ftp_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.maxSpeed') AS max_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.totalBytes') AS total_bytes,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220713' 
    AND length(ftp_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;



------------http--------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_http_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dnsDelay') AS dns_delay,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.requestDelay') AS request_delay,
    get_json_object(j.info,'$.firstPkgDelay') AS first_pkg_delay,
    get_json_object(j.info,'$.firstScreenDelay') AS first_screen_delay,
    get_json_object(j.info,'$.loadDelay') AS load_delay,
    get_json_object(j.info,'$.dlAvgRate') AS dl_avg_rate,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        http_bower_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220713' 
    AND length(http_bower_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.http_bower_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


 
-----------ping---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ping_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.pingType') AS ping_type,
    get_json_object(j.info,'$.packetCount') AS packet_count,
    get_json_object(j.info,'$.packetSize') AS packet_size,
    get_json_object(j.info,'$.minDelay') AS min_delay,
    get_json_object(j.info,'$.maxDelay') AS max_delay,
    get_json_object(j.info,'$.avgDelay') AS avg_delay,
    get_json_object(j.info,'$.jitter') AS jitter,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ping_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220713' 
    AND length(ping_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ping_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
---------spdouyin_-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_spdouyin_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.hotSearchDelay') AS hot_search_delay,
    get_json_object(j.info,'$.recommendDelay') AS recommend_delay,
    get_json_object(j.info,'$.playAttempt') AS play_attempt,
    get_json_object(j.info,'$.playFailured') AS play_failured,
    get_json_object(j.info,'$.playDroped') AS play_droped,
    get_json_object(j.info,'$.initialbuffertime') AS initialbuffertime,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.rbufferCount') AS rbuffer_count,
    get_json_object(j.info,'$.rbufferTime') AS rbuffer_time,
    get_json_object(j.info,'$.maxRbufferTime') AS max_rbuffer_time,
    get_json_object(j.info,'$.bufferRatio') AS buffer_ratio,
    get_json_object(j.info,'$.avgBitrate') AS avg_bitrate,
    get_json_object(j.info,'$.maxBitrate') AS max_bitrate,
    get_json_object(j.info,'$.vmos') AS vmos,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    get_json_object(j.info,'$.avgFrameRate') AS avg_frame_rate,
    get_json_object(j.info,'$.sumBitrate') AS total_bitrate,
    get_json_object(j.info,'$.videoWidth') AS video_width,
    get_json_object(j.info,'$.videoHeight') AS video_height,
    get_json_object(j.info,'$.videoDecoder') AS video_decoder,
    get_json_object(j.info,'$.audioDecoder') AS audio_decoder,
    a.dt,
    a.ht
FROM
(
    SELECT  
        deviceid,
        tiktok_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220713' 
    AND length(tiktok_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.tiktok_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

--end------------------------------------------------------------------------------------
---------strat------------------
---------paramdt-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_paramdt_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.handsetTime') AS handset_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.pointId') AS point_id,
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.sp_seqid') AS sp_seqid,
    get_json_object(j.info,'$.msg_type') AS msg_type,
    get_json_object(j.info,'$.msg_id') AS msg_id,
    get_json_object(j.info,'$.msg_entity') AS msg_entity,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.app_dlrate') AS app_dlrate,
    get_json_object(j.info,'$.app_ulrate') AS app_ulrate,
    get_json_object(j.info,'$.delay') AS delay,
    get_json_object(j.info,'$.vmos') AS vmos,
    get_json_object(j.info,'$.isReal') AS is_real,
    get_json_object(j.info,'$.cellName') AS cell_name,
    get_json_object(j.info,'$.cellDistance') AS cell_distance,
    get_json_object(j.info,'$.isInterference') AS is_interference,
    get_json_object(j.info,'$.isOverlap') AS is_overlap,
    get_json_object(j.info,'$.isNoMajorCell') AS is_no_major_cell,
    get_json_object(j.info,'$.isCrossCoverage') AS is_cross_coverage,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        dt_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220714'  
    AND length(dt_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.dt_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


-----------app---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_app_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.provider') AS provider,
    get_json_object(j.info,'$.filesize') AS filesize,
    get_json_object(j.info,'$.threadCount') AS thread_count,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        app_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220714' 
    AND length(app_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.app_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


----------speed---------------------------------------------------------------------------------------------
INSERT overwrite TABLE knowyou_ott_ods.odm_tair_speed_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.protocolType') AS protocol_type,
    get_json_object(j.info,'$.threads') AS threads,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dlAvgSpeed') AS dl_avg_speed,
    get_json_object(j.info,'$.dlMaxSpeed') AS dl_max_speed,
    get_json_object(j.info,'$.dlDuration') AS dl_duration,
    get_json_object(j.info,'$.dlTotalBytes') AS dl_total_bytes,
    get_json_object(j.info,'$.ulAvgSpeed') AS ul_avg_speed,
    get_json_object(j.info,'$.ulMaxSpeed') AS ul_max_speed,
    get_json_object(j.info,'$.ulDuration') AS ul_duration,
    get_json_object(j.info,'$.ulTotalBytes') AS ul_total_bytes,
    get_json_object(j.info,'$.pingDelay') AS ping_delay,
    get_json_object(j.info,'$.score') AS score,
    get_json_object(j.info,'$.score2') AS score2,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_group_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220714' 
    AND length(ftp_group_info_list) > 2 
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_group_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
-----------ftp---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ftp_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.maxSpeed') AS max_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.totalBytes') AS total_bytes,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220714' 
    AND length(ftp_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;



------------http--------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_http_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dnsDelay') AS dns_delay,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.requestDelay') AS request_delay,
    get_json_object(j.info,'$.firstPkgDelay') AS first_pkg_delay,
    get_json_object(j.info,'$.firstScreenDelay') AS first_screen_delay,
    get_json_object(j.info,'$.loadDelay') AS load_delay,
    get_json_object(j.info,'$.dlAvgRate') AS dl_avg_rate,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        http_bower_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220714' 
    AND length(http_bower_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.http_bower_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


 
-----------ping---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ping_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.pingType') AS ping_type,
    get_json_object(j.info,'$.packetCount') AS packet_count,
    get_json_object(j.info,'$.packetSize') AS packet_size,
    get_json_object(j.info,'$.minDelay') AS min_delay,
    get_json_object(j.info,'$.maxDelay') AS max_delay,
    get_json_object(j.info,'$.avgDelay') AS avg_delay,
    get_json_object(j.info,'$.jitter') AS jitter,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ping_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220714' 
    AND length(ping_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ping_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
---------spdouyin_-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_spdouyin_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.hotSearchDelay') AS hot_search_delay,
    get_json_object(j.info,'$.recommendDelay') AS recommend_delay,
    get_json_object(j.info,'$.playAttempt') AS play_attempt,
    get_json_object(j.info,'$.playFailured') AS play_failured,
    get_json_object(j.info,'$.playDroped') AS play_droped,
    get_json_object(j.info,'$.initialbuffertime') AS initialbuffertime,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.rbufferCount') AS rbuffer_count,
    get_json_object(j.info,'$.rbufferTime') AS rbuffer_time,
    get_json_object(j.info,'$.maxRbufferTime') AS max_rbuffer_time,
    get_json_object(j.info,'$.bufferRatio') AS buffer_ratio,
    get_json_object(j.info,'$.avgBitrate') AS avg_bitrate,
    get_json_object(j.info,'$.maxBitrate') AS max_bitrate,
    get_json_object(j.info,'$.vmos') AS vmos,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    get_json_object(j.info,'$.avgFrameRate') AS avg_frame_rate,
    get_json_object(j.info,'$.sumBitrate') AS total_bitrate,
    get_json_object(j.info,'$.videoWidth') AS video_width,
    get_json_object(j.info,'$.videoHeight') AS video_height,
    get_json_object(j.info,'$.videoDecoder') AS video_decoder,
    get_json_object(j.info,'$.audioDecoder') AS audio_decoder,
    a.dt,
    a.ht
FROM
(
    SELECT  
        deviceid,
        tiktok_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220714' 
    AND length(tiktok_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.tiktok_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

--end------------------------------------------------------------------------------------
---------strat------------------
---------paramdt-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_paramdt_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.handsetTime') AS handset_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.pointId') AS point_id,
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.sp_seqid') AS sp_seqid,
    get_json_object(j.info,'$.msg_type') AS msg_type,
    get_json_object(j.info,'$.msg_id') AS msg_id,
    get_json_object(j.info,'$.msg_entity') AS msg_entity,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.app_dlrate') AS app_dlrate,
    get_json_object(j.info,'$.app_ulrate') AS app_ulrate,
    get_json_object(j.info,'$.delay') AS delay,
    get_json_object(j.info,'$.vmos') AS vmos,
    get_json_object(j.info,'$.isReal') AS is_real,
    get_json_object(j.info,'$.cellName') AS cell_name,
    get_json_object(j.info,'$.cellDistance') AS cell_distance,
    get_json_object(j.info,'$.isInterference') AS is_interference,
    get_json_object(j.info,'$.isOverlap') AS is_overlap,
    get_json_object(j.info,'$.isNoMajorCell') AS is_no_major_cell,
    get_json_object(j.info,'$.isCrossCoverage') AS is_cross_coverage,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        dt_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220715'  
    AND length(dt_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.dt_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


-----------app---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_app_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.provider') AS provider,
    get_json_object(j.info,'$.filesize') AS filesize,
    get_json_object(j.info,'$.threadCount') AS thread_count,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        app_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220715' 
    AND length(app_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.app_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


----------speed---------------------------------------------------------------------------------------------
INSERT overwrite TABLE knowyou_ott_ods.odm_tair_speed_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.protocolType') AS protocol_type,
    get_json_object(j.info,'$.threads') AS threads,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dlAvgSpeed') AS dl_avg_speed,
    get_json_object(j.info,'$.dlMaxSpeed') AS dl_max_speed,
    get_json_object(j.info,'$.dlDuration') AS dl_duration,
    get_json_object(j.info,'$.dlTotalBytes') AS dl_total_bytes,
    get_json_object(j.info,'$.ulAvgSpeed') AS ul_avg_speed,
    get_json_object(j.info,'$.ulMaxSpeed') AS ul_max_speed,
    get_json_object(j.info,'$.ulDuration') AS ul_duration,
    get_json_object(j.info,'$.ulTotalBytes') AS ul_total_bytes,
    get_json_object(j.info,'$.pingDelay') AS ping_delay,
    get_json_object(j.info,'$.score') AS score,
    get_json_object(j.info,'$.score2') AS score2,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_group_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220715' 
    AND length(ftp_group_info_list) > 2 
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_group_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
-----------ftp---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ftp_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.maxSpeed') AS max_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.totalBytes') AS total_bytes,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220715' 
    AND length(ftp_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;



------------http--------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_http_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dnsDelay') AS dns_delay,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.requestDelay') AS request_delay,
    get_json_object(j.info,'$.firstPkgDelay') AS first_pkg_delay,
    get_json_object(j.info,'$.firstScreenDelay') AS first_screen_delay,
    get_json_object(j.info,'$.loadDelay') AS load_delay,
    get_json_object(j.info,'$.dlAvgRate') AS dl_avg_rate,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        http_bower_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220715' 
    AND length(http_bower_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.http_bower_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


 
-----------ping---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ping_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.pingType') AS ping_type,
    get_json_object(j.info,'$.packetCount') AS packet_count,
    get_json_object(j.info,'$.packetSize') AS packet_size,
    get_json_object(j.info,'$.minDelay') AS min_delay,
    get_json_object(j.info,'$.maxDelay') AS max_delay,
    get_json_object(j.info,'$.avgDelay') AS avg_delay,
    get_json_object(j.info,'$.jitter') AS jitter,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ping_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220715' 
    AND length(ping_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ping_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
---------spdouyin_-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_spdouyin_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.hotSearchDelay') AS hot_search_delay,
    get_json_object(j.info,'$.recommendDelay') AS recommend_delay,
    get_json_object(j.info,'$.playAttempt') AS play_attempt,
    get_json_object(j.info,'$.playFailured') AS play_failured,
    get_json_object(j.info,'$.playDroped') AS play_droped,
    get_json_object(j.info,'$.initialbuffertime') AS initialbuffertime,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.rbufferCount') AS rbuffer_count,
    get_json_object(j.info,'$.rbufferTime') AS rbuffer_time,
    get_json_object(j.info,'$.maxRbufferTime') AS max_rbuffer_time,
    get_json_object(j.info,'$.bufferRatio') AS buffer_ratio,
    get_json_object(j.info,'$.avgBitrate') AS avg_bitrate,
    get_json_object(j.info,'$.maxBitrate') AS max_bitrate,
    get_json_object(j.info,'$.vmos') AS vmos,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    get_json_object(j.info,'$.avgFrameRate') AS avg_frame_rate,
    get_json_object(j.info,'$.sumBitrate') AS total_bitrate,
    get_json_object(j.info,'$.videoWidth') AS video_width,
    get_json_object(j.info,'$.videoHeight') AS video_height,
    get_json_object(j.info,'$.videoDecoder') AS video_decoder,
    get_json_object(j.info,'$.audioDecoder') AS audio_decoder,
    a.dt,
    a.ht
FROM
(
    SELECT  
        deviceid,
        tiktok_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220715' 
    AND length(tiktok_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.tiktok_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

--end------------------------------------------------------------------------------------
---------strat------------------
---------paramdt-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_paramdt_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.handsetTime') AS handset_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.pointId') AS point_id,
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.sp_seqid') AS sp_seqid,
    get_json_object(j.info,'$.msg_type') AS msg_type,
    get_json_object(j.info,'$.msg_id') AS msg_id,
    get_json_object(j.info,'$.msg_entity') AS msg_entity,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.app_dlrate') AS app_dlrate,
    get_json_object(j.info,'$.app_ulrate') AS app_ulrate,
    get_json_object(j.info,'$.delay') AS delay,
    get_json_object(j.info,'$.vmos') AS vmos,
    get_json_object(j.info,'$.isReal') AS is_real,
    get_json_object(j.info,'$.cellName') AS cell_name,
    get_json_object(j.info,'$.cellDistance') AS cell_distance,
    get_json_object(j.info,'$.isInterference') AS is_interference,
    get_json_object(j.info,'$.isOverlap') AS is_overlap,
    get_json_object(j.info,'$.isNoMajorCell') AS is_no_major_cell,
    get_json_object(j.info,'$.isCrossCoverage') AS is_cross_coverage,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        dt_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220716'  
    AND length(dt_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.dt_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


-----------app---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_app_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.provider') AS provider,
    get_json_object(j.info,'$.filesize') AS filesize,
    get_json_object(j.info,'$.threadCount') AS thread_count,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        app_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220716' 
    AND length(app_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.app_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


----------speed---------------------------------------------------------------------------------------------
INSERT overwrite TABLE knowyou_ott_ods.odm_tair_speed_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.protocolType') AS protocol_type,
    get_json_object(j.info,'$.threads') AS threads,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dlAvgSpeed') AS dl_avg_speed,
    get_json_object(j.info,'$.dlMaxSpeed') AS dl_max_speed,
    get_json_object(j.info,'$.dlDuration') AS dl_duration,
    get_json_object(j.info,'$.dlTotalBytes') AS dl_total_bytes,
    get_json_object(j.info,'$.ulAvgSpeed') AS ul_avg_speed,
    get_json_object(j.info,'$.ulMaxSpeed') AS ul_max_speed,
    get_json_object(j.info,'$.ulDuration') AS ul_duration,
    get_json_object(j.info,'$.ulTotalBytes') AS ul_total_bytes,
    get_json_object(j.info,'$.pingDelay') AS ping_delay,
    get_json_object(j.info,'$.score') AS score,
    get_json_object(j.info,'$.score2') AS score2,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_group_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220716' 
    AND length(ftp_group_info_list) > 2 
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_group_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
-----------ftp---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ftp_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.maxSpeed') AS max_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.totalBytes') AS total_bytes,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220716' 
    AND length(ftp_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;



------------http--------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_http_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dnsDelay') AS dns_delay,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.requestDelay') AS request_delay,
    get_json_object(j.info,'$.firstPkgDelay') AS first_pkg_delay,
    get_json_object(j.info,'$.firstScreenDelay') AS first_screen_delay,
    get_json_object(j.info,'$.loadDelay') AS load_delay,
    get_json_object(j.info,'$.dlAvgRate') AS dl_avg_rate,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        http_bower_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220716' 
    AND length(http_bower_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.http_bower_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


 
-----------ping---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ping_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.pingType') AS ping_type,
    get_json_object(j.info,'$.packetCount') AS packet_count,
    get_json_object(j.info,'$.packetSize') AS packet_size,
    get_json_object(j.info,'$.minDelay') AS min_delay,
    get_json_object(j.info,'$.maxDelay') AS max_delay,
    get_json_object(j.info,'$.avgDelay') AS avg_delay,
    get_json_object(j.info,'$.jitter') AS jitter,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ping_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220716' 
    AND length(ping_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ping_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
---------spdouyin_-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_spdouyin_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.hotSearchDelay') AS hot_search_delay,
    get_json_object(j.info,'$.recommendDelay') AS recommend_delay,
    get_json_object(j.info,'$.playAttempt') AS play_attempt,
    get_json_object(j.info,'$.playFailured') AS play_failured,
    get_json_object(j.info,'$.playDroped') AS play_droped,
    get_json_object(j.info,'$.initialbuffertime') AS initialbuffertime,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.rbufferCount') AS rbuffer_count,
    get_json_object(j.info,'$.rbufferTime') AS rbuffer_time,
    get_json_object(j.info,'$.maxRbufferTime') AS max_rbuffer_time,
    get_json_object(j.info,'$.bufferRatio') AS buffer_ratio,
    get_json_object(j.info,'$.avgBitrate') AS avg_bitrate,
    get_json_object(j.info,'$.maxBitrate') AS max_bitrate,
    get_json_object(j.info,'$.vmos') AS vmos,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    get_json_object(j.info,'$.avgFrameRate') AS avg_frame_rate,
    get_json_object(j.info,'$.sumBitrate') AS total_bitrate,
    get_json_object(j.info,'$.videoWidth') AS video_width,
    get_json_object(j.info,'$.videoHeight') AS video_height,
    get_json_object(j.info,'$.videoDecoder') AS video_decoder,
    get_json_object(j.info,'$.audioDecoder') AS audio_decoder,
    a.dt,
    a.ht
FROM
(
    SELECT  
        deviceid,
        tiktok_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220716' 
    AND length(tiktok_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.tiktok_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

--end------------------------------------------------------------------------------------
---------strat------------------
---------paramdt-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_paramdt_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.handsetTime') AS handset_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.pointId') AS point_id,
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.sp_seqid') AS sp_seqid,
    get_json_object(j.info,'$.msg_type') AS msg_type,
    get_json_object(j.info,'$.msg_id') AS msg_id,
    get_json_object(j.info,'$.msg_entity') AS msg_entity,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.app_dlrate') AS app_dlrate,
    get_json_object(j.info,'$.app_ulrate') AS app_ulrate,
    get_json_object(j.info,'$.delay') AS delay,
    get_json_object(j.info,'$.vmos') AS vmos,
    get_json_object(j.info,'$.isReal') AS is_real,
    get_json_object(j.info,'$.cellName') AS cell_name,
    get_json_object(j.info,'$.cellDistance') AS cell_distance,
    get_json_object(j.info,'$.isInterference') AS is_interference,
    get_json_object(j.info,'$.isOverlap') AS is_overlap,
    get_json_object(j.info,'$.isNoMajorCell') AS is_no_major_cell,
    get_json_object(j.info,'$.isCrossCoverage') AS is_cross_coverage,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        dt_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220717'  
    AND length(dt_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.dt_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


-----------app---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_app_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.provider') AS provider,
    get_json_object(j.info,'$.filesize') AS filesize,
    get_json_object(j.info,'$.threadCount') AS thread_count,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        app_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220717' 
    AND length(app_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.app_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


----------speed---------------------------------------------------------------------------------------------
INSERT overwrite TABLE knowyou_ott_ods.odm_tair_speed_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.protocolType') AS protocol_type,
    get_json_object(j.info,'$.threads') AS threads,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dlAvgSpeed') AS dl_avg_speed,
    get_json_object(j.info,'$.dlMaxSpeed') AS dl_max_speed,
    get_json_object(j.info,'$.dlDuration') AS dl_duration,
    get_json_object(j.info,'$.dlTotalBytes') AS dl_total_bytes,
    get_json_object(j.info,'$.ulAvgSpeed') AS ul_avg_speed,
    get_json_object(j.info,'$.ulMaxSpeed') AS ul_max_speed,
    get_json_object(j.info,'$.ulDuration') AS ul_duration,
    get_json_object(j.info,'$.ulTotalBytes') AS ul_total_bytes,
    get_json_object(j.info,'$.pingDelay') AS ping_delay,
    get_json_object(j.info,'$.score') AS score,
    get_json_object(j.info,'$.score2') AS score2,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_group_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220717' 
    AND length(ftp_group_info_list) > 2 
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_group_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
-----------ftp---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ftp_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.maxSpeed') AS max_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.totalBytes') AS total_bytes,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220717' 
    AND length(ftp_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;



------------http--------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_http_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dnsDelay') AS dns_delay,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.requestDelay') AS request_delay,
    get_json_object(j.info,'$.firstPkgDelay') AS first_pkg_delay,
    get_json_object(j.info,'$.firstScreenDelay') AS first_screen_delay,
    get_json_object(j.info,'$.loadDelay') AS load_delay,
    get_json_object(j.info,'$.dlAvgRate') AS dl_avg_rate,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        http_bower_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220717' 
    AND length(http_bower_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.http_bower_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


 
-----------ping---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ping_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.pingType') AS ping_type,
    get_json_object(j.info,'$.packetCount') AS packet_count,
    get_json_object(j.info,'$.packetSize') AS packet_size,
    get_json_object(j.info,'$.minDelay') AS min_delay,
    get_json_object(j.info,'$.maxDelay') AS max_delay,
    get_json_object(j.info,'$.avgDelay') AS avg_delay,
    get_json_object(j.info,'$.jitter') AS jitter,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ping_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220717' 
    AND length(ping_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ping_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
---------spdouyin_-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_spdouyin_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.hotSearchDelay') AS hot_search_delay,
    get_json_object(j.info,'$.recommendDelay') AS recommend_delay,
    get_json_object(j.info,'$.playAttempt') AS play_attempt,
    get_json_object(j.info,'$.playFailured') AS play_failured,
    get_json_object(j.info,'$.playDroped') AS play_droped,
    get_json_object(j.info,'$.initialbuffertime') AS initialbuffertime,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.rbufferCount') AS rbuffer_count,
    get_json_object(j.info,'$.rbufferTime') AS rbuffer_time,
    get_json_object(j.info,'$.maxRbufferTime') AS max_rbuffer_time,
    get_json_object(j.info,'$.bufferRatio') AS buffer_ratio,
    get_json_object(j.info,'$.avgBitrate') AS avg_bitrate,
    get_json_object(j.info,'$.maxBitrate') AS max_bitrate,
    get_json_object(j.info,'$.vmos') AS vmos,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    get_json_object(j.info,'$.avgFrameRate') AS avg_frame_rate,
    get_json_object(j.info,'$.sumBitrate') AS total_bitrate,
    get_json_object(j.info,'$.videoWidth') AS video_width,
    get_json_object(j.info,'$.videoHeight') AS video_height,
    get_json_object(j.info,'$.videoDecoder') AS video_decoder,
    get_json_object(j.info,'$.audioDecoder') AS audio_decoder,
    a.dt,
    a.ht
FROM
(
    SELECT  
        deviceid,
        tiktok_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220717' 
    AND length(tiktok_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.tiktok_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

--end------------------------------------------------------------------------------------
---------strat------------------
---------paramdt-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_paramdt_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.handsetTime') AS handset_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.pointId') AS point_id,
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.sp_seqid') AS sp_seqid,
    get_json_object(j.info,'$.msg_type') AS msg_type,
    get_json_object(j.info,'$.msg_id') AS msg_id,
    get_json_object(j.info,'$.msg_entity') AS msg_entity,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.app_dlrate') AS app_dlrate,
    get_json_object(j.info,'$.app_ulrate') AS app_ulrate,
    get_json_object(j.info,'$.delay') AS delay,
    get_json_object(j.info,'$.vmos') AS vmos,
    get_json_object(j.info,'$.isReal') AS is_real,
    get_json_object(j.info,'$.cellName') AS cell_name,
    get_json_object(j.info,'$.cellDistance') AS cell_distance,
    get_json_object(j.info,'$.isInterference') AS is_interference,
    get_json_object(j.info,'$.isOverlap') AS is_overlap,
    get_json_object(j.info,'$.isNoMajorCell') AS is_no_major_cell,
    get_json_object(j.info,'$.isCrossCoverage') AS is_cross_coverage,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        dt_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220718'  
    AND length(dt_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.dt_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


-----------app---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_app_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.provider') AS provider,
    get_json_object(j.info,'$.filesize') AS filesize,
    get_json_object(j.info,'$.threadCount') AS thread_count,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        app_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220718' 
    AND length(app_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.app_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


----------speed---------------------------------------------------------------------------------------------
INSERT overwrite TABLE knowyou_ott_ods.odm_tair_speed_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.protocolType') AS protocol_type,
    get_json_object(j.info,'$.threads') AS threads,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dlAvgSpeed') AS dl_avg_speed,
    get_json_object(j.info,'$.dlMaxSpeed') AS dl_max_speed,
    get_json_object(j.info,'$.dlDuration') AS dl_duration,
    get_json_object(j.info,'$.dlTotalBytes') AS dl_total_bytes,
    get_json_object(j.info,'$.ulAvgSpeed') AS ul_avg_speed,
    get_json_object(j.info,'$.ulMaxSpeed') AS ul_max_speed,
    get_json_object(j.info,'$.ulDuration') AS ul_duration,
    get_json_object(j.info,'$.ulTotalBytes') AS ul_total_bytes,
    get_json_object(j.info,'$.pingDelay') AS ping_delay,
    get_json_object(j.info,'$.score') AS score,
    get_json_object(j.info,'$.score2') AS score2,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_group_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220718' 
    AND length(ftp_group_info_list) > 2 
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_group_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
-----------ftp---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ftp_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.maxSpeed') AS max_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.totalBytes') AS total_bytes,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220718' 
    AND length(ftp_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;



------------http--------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_http_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dnsDelay') AS dns_delay,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.requestDelay') AS request_delay,
    get_json_object(j.info,'$.firstPkgDelay') AS first_pkg_delay,
    get_json_object(j.info,'$.firstScreenDelay') AS first_screen_delay,
    get_json_object(j.info,'$.loadDelay') AS load_delay,
    get_json_object(j.info,'$.dlAvgRate') AS dl_avg_rate,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        http_bower_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220718' 
    AND length(http_bower_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.http_bower_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


 
-----------ping---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ping_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.pingType') AS ping_type,
    get_json_object(j.info,'$.packetCount') AS packet_count,
    get_json_object(j.info,'$.packetSize') AS packet_size,
    get_json_object(j.info,'$.minDelay') AS min_delay,
    get_json_object(j.info,'$.maxDelay') AS max_delay,
    get_json_object(j.info,'$.avgDelay') AS avg_delay,
    get_json_object(j.info,'$.jitter') AS jitter,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ping_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220718' 
    AND length(ping_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ping_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
---------spdouyin_-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_spdouyin_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.hotSearchDelay') AS hot_search_delay,
    get_json_object(j.info,'$.recommendDelay') AS recommend_delay,
    get_json_object(j.info,'$.playAttempt') AS play_attempt,
    get_json_object(j.info,'$.playFailured') AS play_failured,
    get_json_object(j.info,'$.playDroped') AS play_droped,
    get_json_object(j.info,'$.initialbuffertime') AS initialbuffertime,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.rbufferCount') AS rbuffer_count,
    get_json_object(j.info,'$.rbufferTime') AS rbuffer_time,
    get_json_object(j.info,'$.maxRbufferTime') AS max_rbuffer_time,
    get_json_object(j.info,'$.bufferRatio') AS buffer_ratio,
    get_json_object(j.info,'$.avgBitrate') AS avg_bitrate,
    get_json_object(j.info,'$.maxBitrate') AS max_bitrate,
    get_json_object(j.info,'$.vmos') AS vmos,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    get_json_object(j.info,'$.avgFrameRate') AS avg_frame_rate,
    get_json_object(j.info,'$.sumBitrate') AS total_bitrate,
    get_json_object(j.info,'$.videoWidth') AS video_width,
    get_json_object(j.info,'$.videoHeight') AS video_height,
    get_json_object(j.info,'$.videoDecoder') AS video_decoder,
    get_json_object(j.info,'$.audioDecoder') AS audio_decoder,
    a.dt,
    a.ht
FROM
(
    SELECT  
        deviceid,
        tiktok_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220718' 
    AND length(tiktok_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.tiktok_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

--end------------------------------------------------------------------------------------
---------strat------------------
---------paramdt-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_paramdt_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.handsetTime') AS handset_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.pointId') AS point_id,
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.sp_seqid') AS sp_seqid,
    get_json_object(j.info,'$.msg_type') AS msg_type,
    get_json_object(j.info,'$.msg_id') AS msg_id,
    get_json_object(j.info,'$.msg_entity') AS msg_entity,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.app_dlrate') AS app_dlrate,
    get_json_object(j.info,'$.app_ulrate') AS app_ulrate,
    get_json_object(j.info,'$.delay') AS delay,
    get_json_object(j.info,'$.vmos') AS vmos,
    get_json_object(j.info,'$.isReal') AS is_real,
    get_json_object(j.info,'$.cellName') AS cell_name,
    get_json_object(j.info,'$.cellDistance') AS cell_distance,
    get_json_object(j.info,'$.isInterference') AS is_interference,
    get_json_object(j.info,'$.isOverlap') AS is_overlap,
    get_json_object(j.info,'$.isNoMajorCell') AS is_no_major_cell,
    get_json_object(j.info,'$.isCrossCoverage') AS is_cross_coverage,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        dt_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220719'  
    AND length(dt_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.dt_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


-----------app---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_app_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.provider') AS provider,
    get_json_object(j.info,'$.filesize') AS filesize,
    get_json_object(j.info,'$.threadCount') AS thread_count,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        app_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220719' 
    AND length(app_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.app_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


----------speed---------------------------------------------------------------------------------------------
INSERT overwrite TABLE knowyou_ott_ods.odm_tair_speed_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    get_json_object(j.info,'$.protocolType') AS protocol_type,
    get_json_object(j.info,'$.threads') AS threads,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dlAvgSpeed') AS dl_avg_speed,
    get_json_object(j.info,'$.dlMaxSpeed') AS dl_max_speed,
    get_json_object(j.info,'$.dlDuration') AS dl_duration,
    get_json_object(j.info,'$.dlTotalBytes') AS dl_total_bytes,
    get_json_object(j.info,'$.ulAvgSpeed') AS ul_avg_speed,
    get_json_object(j.info,'$.ulMaxSpeed') AS ul_max_speed,
    get_json_object(j.info,'$.ulDuration') AS ul_duration,
    get_json_object(j.info,'$.ulTotalBytes') AS ul_total_bytes,
    get_json_object(j.info,'$.pingDelay') AS ping_delay,
    get_json_object(j.info,'$.score') AS score,
    get_json_object(j.info,'$.score2') AS score2,
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_group_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220719' 
    AND length(ftp_group_info_list) > 2 
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_group_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
-----------ftp---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ftp_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.sp_type') AS sp_type,
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.avgSpeed') AS avg_speed,
    get_json_object(j.info,'$.maxSpeed') AS max_speed,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.totalBytes') AS total_bytes,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ftp_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220719' 
    AND length(ftp_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ftp_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;



------------http--------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_http_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.dnsDelay') AS dns_delay,
    get_json_object(j.info,'$.connectDelay') AS connect_delay,
    get_json_object(j.info,'$.requestDelay') AS request_delay,
    get_json_object(j.info,'$.firstPkgDelay') AS first_pkg_delay,
    get_json_object(j.info,'$.firstScreenDelay') AS first_screen_delay,
    get_json_object(j.info,'$.loadDelay') AS load_delay,
    get_json_object(j.info,'$.dlAvgRate') AS dl_avg_rate,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        http_bower_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220719' 
    AND length(http_bower_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.http_bower_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;


 
-----------ping---------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_ping_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.serverName') AS server_name,
    get_json_object(j.info,'$.serverIp') AS server_ip,
    get_json_object(j.info,'$.url') AS url,
    get_json_object(j.info,'$.pingType') AS ping_type,
    get_json_object(j.info,'$.packetCount') AS packet_count,
    get_json_object(j.info,'$.packetSize') AS packet_size,
    get_json_object(j.info,'$.minDelay') AS min_delay,
    get_json_object(j.info,'$.maxDelay') AS max_delay,
    get_json_object(j.info,'$.avgDelay') AS avg_delay,
    get_json_object(j.info,'$.jitter') AS jitter,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    a.dt,a.ht
FROM
(
    SELECT  
        deviceid,
        ping_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220719' 
    AND length(ping_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.ping_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

 
---------spdouyin_-----------------------------------------------------------------------------------------------

INSERT overwrite TABLE knowyou_ott_ods.odm_tair_spdouyin_dm partition(dt,ht)
SELECT  
    a.deviceid,
    get_json_object(j.info,'$.id') AS id,
    get_json_object(j.info,'$.deviceType') AS device_type,
    get_json_object(j.info,'$.port') AS port,
    get_json_object(j.info,'$.groupId') AS group_id,
    get_json_object(j.info,'$.taskName') AS task_name,
    get_json_object(j.info,'$.taskType') AS task_type,
    get_json_object(j.info,'$.testPlanId') AS test_plan_id,
    get_json_object(j.info,'$.testType') AS test_type,
    get_json_object(j.info,'$.scene_type') AS scene_type,
    get_json_object(j.info,'$.scene_name') AS scene_name,
    get_json_object(j.info,'$.scene_mark') AS scene_mark,
    get_json_object(j.info,'$.beginTime') AS begin_time,
    get_json_object(j.info,'$.endTime') AS end_time,
    get_json_object(j.info,'$.operatorId') AS operator_id,
    get_json_object(j.info,'$.mcc') AS mcc,
    get_json_object(j.info,'$.mnc') AS mnc,
    get_json_object(j.info,'$.network_Class') AS network_class,
    get_json_object(j.info,'$.network_Type') AS network_type,
    get_json_object(j.info,'$.internalIp') AS internal_ip,
    get_json_object(j.info,'$.externalIp') AS external_ip,
    get_json_object(j.info,'$.app_list') AS app_list,
    
    get_json_object(j.info,'$.hotSearchDelay') AS hot_search_delay,
    get_json_object(j.info,'$.recommendDelay') AS recommend_delay,
    get_json_object(j.info,'$.playAttempt') AS play_attempt,
    get_json_object(j.info,'$.playFailured') AS play_failured,
    get_json_object(j.info,'$.playDroped') AS play_droped,
    get_json_object(j.info,'$.initialbuffertime') AS initialbuffertime,
    get_json_object(j.info,'$.duration') AS duration,
    get_json_object(j.info,'$.rbufferCount') AS rbuffer_count,
    get_json_object(j.info,'$.rbufferTime') AS rbuffer_time,
    get_json_object(j.info,'$.maxRbufferTime') AS max_rbuffer_time,
    get_json_object(j.info,'$.bufferRatio') AS buffer_ratio,
    get_json_object(j.info,'$.avgBitrate') AS avg_bitrate,
    get_json_object(j.info,'$.maxBitrate') AS max_bitrate,
    get_json_object(j.info,'$.vmos') AS vmos,
    
    get_json_object(j.info,'$.result') AS result,
    get_json_object(j.info,'$.lte_tac') AS lte_tac,
    get_json_object(j.info,'$.lte_eci') AS lte_eci,
    get_json_object(j.info,'$.lte_earfcn') AS lte_earfcn,
    get_json_object(j.info,'$.lte_enodBID') AS lte_enod_bid,
    get_json_object(j.info,'$.lte_cellid') AS lte_cellid,
    get_json_object(j.info,'$.lte_pci') AS lte_pci,
    get_json_object(j.info,'$.lte_rsrp') AS lte_rsrp,
    get_json_object(j.info,'$.lte_sinr') AS lte_sinr,
    get_json_object(j.info,'$.lte_rsrq') AS lte_rsrq,
    get_json_object(j.info,'$.lte_nbrlist') AS lte_nbrlist,
    get_json_object(j.info,'$.nr_type') AS nr_type,
    get_json_object(j.info,'$.nr_tac') AS nr_tac,
    get_json_object(j.info,'$.nr_eci') AS nr_eci,
    get_json_object(j.info,'$.nr_earfcn') AS nr_earfcn,
    get_json_object(j.info,'$.nr_enodBID') AS nr_enod_bid,
    get_json_object(j.info,'$.nr_cellid') AS nr_cellid,
    get_json_object(j.info,'$.nr_pci') AS nr_pci,
    get_json_object(j.info,'$.nr_rsrp') AS nr_rsrp,
    get_json_object(j.info,'$.nr_sinr') AS nr_sinr,
    get_json_object(j.info,'$.nr_rsrq') AS nr_rsrq,
    get_json_object(j.info,'$.nr_nbrlist') AS nr_nbrlist,
    get_json_object(j.info,'$.wifi_manufacturer') AS wifi_manufacturer,
    get_json_object(j.info,'$.wifi_name') AS wifi_name,
    get_json_object(j.info,'$.wifi_mac') AS wifi_mac,
    get_json_object(j.info,'$.wifi_freq') AS wifi_freq,
    get_json_object(j.info,'$.wifi_strenth') AS wifi_strenth,
    get_json_object(j.info,'$.wifi_operatorId') AS wifi_operator_id,
    get_json_object(j.info,'$.latitude') AS latitude,
    get_json_object(j.info,'$.longitude') AS longitude,
    get_json_object(j.info,'$.grid_id') AS grid_id,
    get_json_object(j.info,'$.grid_length') AS grid_length,
    get_json_object(j.info,'$.grid_lefttop_x') AS grid_lefttop_x,
    get_json_object(j.info,'$.grid_lefttop_y') AS grid_lefttop_y,
    get_json_object(j.info,'$.grid_rightbottom_x') AS grid_rightbottom_x,
    get_json_object(j.info,'$.grid_rightbottom_y') AS grid_rightbottom_y,
    get_json_object(j.info,'$.loctype') AS loctype,
    get_json_object(j.info,'$.network_loctype') AS network_loctype,
    get_json_object(j.info,'$.loc_where') AS loc_where,
    get_json_object(j.info,'$.accuracy') AS accuracy,
    get_json_object(j.info,'$.altitude') AS altitude,
    get_json_object(j.info,'$.sate_number') AS sate_number,
    get_json_object(j.info,'$.pressure') AS pressure,
    get_json_object(j.info,'$.speed') AS speed,
    get_json_object(j.info,'$.direction') AS direction,
    get_json_object(j.info,'$.province') AS province,
    get_json_object(j.info,'$.city') AS city,
    get_json_object(j.info,'$.district') AS district,
    get_json_object(j.info,'$.address') AS address,
    get_json_object(j.info,'$.isIndoor') AS is_indoor,
    a.msgtype,
    a.process_time,
    a.reportdate,
    get_json_object(j.info,'$.avgFrameRate') AS avg_frame_rate,
    get_json_object(j.info,'$.sumBitrate') AS total_bitrate,
    get_json_object(j.info,'$.videoWidth') AS video_width,
    get_json_object(j.info,'$.videoHeight') AS video_height,
    get_json_object(j.info,'$.videoDecoder') AS video_decoder,
    get_json_object(j.info,'$.audioDecoder') AS audio_decoder,
    a.dt,
    a.ht
FROM
(
    SELECT  
        deviceid,
        tiktok_info_list,
        msgtype,
        process_time,
        reportdate,
        dt,ht
    FROM knowyou_ott_ods.odm_tair_info_tmp
    WHERE dt='20220719' 
    AND length(tiktok_info_list) > 2
)a
lateral view explode(split(regexp_replace(regexp_replace(a.tiktok_info_list,'\\[|\\]',''),'\\}\\,\\{','\\}\\;\\{'),'\\;')) j as info;

--end------------------------------------------------------------------------------------
